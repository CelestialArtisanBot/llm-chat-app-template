<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PICK OF GODS's AI CHAT</title>
    <style>
      :root {
        --dark-bg: #03040a;
        --dark-fade: #0a0e14;
        --neon-blue: #00e5ff;
        --neon-glow: rgba(0, 229, 255, 0.5);
        --neon-purple: #8a2be2;
        --text-color: #e6e6e6;
        --text-light: #b0b0b0;
        --chat-bg: #0a0e14;
        --user-msg-bg: #1e2a3a;
        --assistant-msg-bg: #0d1117;
        --border-color: #2f363d;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        line-height: 1.6;
        color: var(--text-color);
        background-color: var(--dark-bg);
        background-image:
          linear-gradient(
            to bottom,
            var(--dark-fade),
            var(--dark-bg) 50%,
            var(--dark-fade)
          ),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Crect x='0' y='0' width='100' height='100' fill='%230a0e14'/%3E%3Cpath d='M4 0h1v100H4V0zM96 0h1v100h-1V0zM0 4h100v1H0V4zM0 96h100v1H0V96z' fill-opacity='.1'/%3E%3Cpath d='M10 0h1v100h-1V0zM20 0h1v100h-1V0zM30 0h1v100h-1V0zM40 0h1v100h-1V0zM50 0h1v100h-1V0zM60 0h1v100h-1V0zM70 0h1v100h-1V0zM80 0h1v100h-1V0zM90 0h1v100h-1V0zM0 10h100v1H0V10zM0 20h100v1H0V20zM0 30h100v1H0V30zM0 40h100v1H0V40zM0 50h100v1H0V50zM0 60h100v1H0V60zM0 70h100v1H0V70zM0 80h100v1H0V80zM0 90h100v1H0V90z' fill-opacity='.05'/%3E%3C/svg%3E");
        max-width: 800px;
        margin: 0 auto;
        padding: 1rem;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 1rem 0;
        border-bottom: 2px solid var(--neon-blue);
        box-shadow: 0 2px 10px var(--neon-glow);
      }

      h1 {
        font-size: 1.8rem;
        color: var(--neon-blue);
        text-shadow: 0 0 5px var(--neon-blue);
      }

      .footer-handle {
        color: var(--neon-purple);
        font-weight: bold;
        text-shadow: 0 0 3px var(--neon-purple);
      }

      .controls-container {
        margin-top: 1rem;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 1rem;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .control-group label {
        color: var(--text-light);
      }

      .control-group select,
      .control-group input {
        padding: 0.5rem;
        background-color: var(--assistant-msg-bg);
        color: var(--text-color);
        border: 2px solid var(--neon-purple);
        border-radius: 4px;
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        width: 100px;
      }

      .chat-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 250px);
        min-height: 400px;
        border: 2px solid var(--neon-blue);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 20px var(--neon-glow);
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background-color: var(--chat-bg);
      }

      .message {
        margin-bottom: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
        max-width: 80%;
        border: 1px solid var(--border-color);
      }

      .user-message {
        background-color: var(--user-msg-bg);
        align-self: flex-end;
        margin-left: auto;
        border: 1px solid var(--neon-purple);
      }

      .assistant-message {
        background-color: var(--assistant-msg-bg);
        align-self: flex-start;
        border: 1px solid var(--neon-blue);
      }

      .message-input {
        display: flex;
        padding: 0.75rem;
        border-top: 2px solid var(--neon-blue);
        background-color: var(--dark-bg);
        box-shadow: 0 -2px 10px var(--neon-glow);
      }

      #user-input {
        flex: 1;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        background-color: var(--assistant-msg-bg);
        color: var(--text-color);
        border-radius: 4px;
        font-family: inherit;
        resize: none;
        min-height: 44px;
      }

      #send-button {
        margin-left: 0.5rem;
        padding: 0 1rem;
        background-color: var(--neon-blue);
        color: var(--dark-bg);
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s, box-shadow 0.2s;
        text-shadow: none;
        font-weight: bold;
      }

      #send-button:hover {
        background-color: var(--neon-purple);
        box-shadow: 0 0 5px var(--neon-purple);
      }

      #send-button:disabled {
        background-color: var(--text-light);
        cursor: not-allowed;
      }

      .typing-indicator {
        display: none;
        margin-bottom: 1rem;
        font-style: italic;
        color: var(--neon-purple);
      }

      .typing-indicator.visible {
        display: block;
      }

      footer {
        margin-top: 1rem;
        text-align: center;
        font-size: 0.85rem;
        color: var(--text-light);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Cloudflare AI Chat</h1>
      <p>Powered by Cloudflare Workers AI and Gemini API</p>
      <div class="controls-container">
        <div class="control-group">
          <label for="model-select">Model:</label>
          <select id="model-select">
            <option value="workers-ai">Workers AI (Llama)</option>
            <option value="gemini">Gemini API</option>
          </select>
        </div>
        <div class="control-group">
          <label for="temperature-input">Temp:</label>
          <input
            type="number"
            id="temperature-input"
            value="0.9"
            step="0.1"
            min="0"
            max="2"
          />
        </div>
        <div class="control-group">
          <label for="topK-input">topK:</label>
          <input
            type="number"
            id="topK-input"
            value="1"
            step="1"
            min="0"
            max="40"
          />
        </div>
        <div class="control-group">
          <label for="topP-input">topP:</label>
          <input
            type="number"
            id="topP-input"
            value="1"
            step="0.1"
            min="0"
            max="1"
          />
        </div>
      </div>
    </header>

    <div class="chat-container">
      <div id="chat-messages" class="chat-messages">
        <div class="message assistant-message">
          <p>
            Hello! I'm an LLM chat app powered by both Workers AI and the Gemini API.
                       I LOVE YOU, DESERAY!!
          </p>
        </div>
      </div>

      <div class="typing-indicator" id="typing-indicator">
        AI's stinking about your message...
      </div>

      <div class="message-input">
        <textarea
          id="user-input"
          placeholder="Type your message here..."
          rows="1"
          autofocus
        ></textarea>
        <button id="send-button">Send</button>
      </div>
    </div>

    <footer>
      <p>Cloudflare Workers AI Chat Template &copy; 2025</p>
      <p>Created by <span class="footer-handle">Pick-of-Gods @ RUNESCAPE.COM</span></p>
    </footer>

    <script src="Chat.js"></script>
  </body>
</html>
            const response = await fetch("/api/chat", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(params),
            });

            if (!response.ok) {
              throw new Error("Failed to get response");
            }
            
            // Handle streaming response
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let responseText = "";

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value, { stream: true });
                responseText += chunk;
                assistantMessageEl.querySelector("p").textContent = responseText;
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            this.chatHistory.push({ role: "assistant", content: responseText });
          } catch (error) {
            console.error("Error:", error);
            this.addMessageToChat("assistant", "Sorry, there was an error processing your request.");
          } finally {
            this.typingIndicator.classList.remove("visible");
            this.isProcessing = false;
            this.userInput.disabled = false;
            this.sendButton.disabled = false;
            this.userInput.focus();
          }
        }

      h1 {
        font-size: 1.8rem;
        color: var(--neon-blue);
        text-shadow: 0 0 5px var(--neon-blue);
      }

      .footer-handle {
        color: var(--neon-purple);
        font-weight: bold;
        text-shadow: 0 0 3px var(--neon-purple);
      }

      .controls-container {
        margin-top: 1rem;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 1rem;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .control-group label {
        color: var(--text-light);
      }

      .control-group select,
      .control-group input {
        padding: 0.5rem;
        background-color: var(--assistant-msg-bg);
        color: var(--text-color);
        border: 2px solid var(--neon-purple);
        border-radius: 4px;
        appearance: none;
        -webkit-appearance: none;
        cursor: pointer;
        width: 100px;
      }

      .chat-container {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 250px);
        min-height: 400px;
        border: 2px solid var(--neon-blue);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 20px var(--neon-glow);
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background-color: var(--chat-bg);
      }

      .message {
        margin-bottom: 1rem;
        padding: 0.75rem;
        border-radius: 8px;
        max-width: 80%;
        border: 1px solid var(--border-color);
      }

      .user-message {
        background-color: var(--user-msg-bg);
        align-self: flex-end;
        margin-left: auto;
        border: 1px solid var(--neon-purple);
      }

      .assistant-message {
        background-color: var(--assistant-msg-bg);
        align-self: flex-start;
        border: 1px solid var(--neon-blue);
      }

      .message-input {
        display: flex;
        padding: 0.75rem;
        border-top: 2px solid var(--neon-blue);
        background-color: var(--dark-bg);
        box-shadow: 0 -2px 10px var(--neon-glow);
      }

      #user-input {
        flex: 1;
        padding: 0.75rem;
        border: 1px solid var(--border-color);
        background-color: var(--assistant-msg-bg);
        color: var(--text-color);
        border-radius: 4px;
        font-family: inherit;
        resize: none;
        min-height: 44px;
      }

      #send-button {
        margin-left: 0.5rem;
        padding: 0 1rem;
        background-color: var(--neon-blue);
        color: var(--dark-bg);
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s, box-shadow 0.2s;
        text-shadow: none;
        font-weight: bold;
      }

      #send-button:hover {
        background-color: var(--neon-purple);
        box-shadow: 0 0 5px var(--neon-purple);
      }

      #send-button:disabled {
        background-color: var(--text-light);
        cursor: not-allowed;
      }

      .typing-indicator {
        display: none;
        margin-bottom: 1rem;
        font-style: italic;
        color: var(--neon-purple);
      }

      .typing-indicator.visible {
        display: block;
      }

      footer {
        margin-top: 1rem;
        text-align: center;
        font-size: 0.85rem;
        color: var(--text-light);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Cloudflare AI Chat</h1>
      <p>Powered by Cloudflare Workers AI and Gemini API</p>
      <div class="controls-container">
        <div class="control-group">
          <label for="model-select">Model:</label>
          <select id="model-select">
            <option value="workers-ai">Workers AI (Llama)</option>
            <option value="gemini">Gemini API</option>
          </select>
        </div>
        <div class="control-group">
          <label for="temperature-input">Temp:</label>
          <input
            type="number"
            id="temperature-input"
            value="0.9"
            step="0.1"
            min="0"
            max="2"
          />
        </div>
        <div class="control-group">
          <label for="topK-input">topK:</label>
          <input
            type="number"
            id="topK-input"
            value="1"
            step="1"
            min="0"
            max="40"
          />
        </div>
        <div class="control-group">
          <label for="topP-input">topP:</label>
          <input
            type="number"
            id="topP-input"
            value="1"
            step="0.1"
            min="0"
            max="1"
          />
        </div>
      </div>
    </header>

    <div class="chat-container">
      <div id="chat-messages" class="chat-messages">
        <div class="message assistant-message">
          <p>
            Hello! I'm an LLM chat app powered by both Workers AI and the Gemini API.
                       I LOVE YOU, DESERAY!!
          </p>
        </div>
      </div>

      <div class="typing-indicator" id="typing-indicator">
        AI's stinking about your message...
      </div>

      <div class="message-input">
        <textarea
          id="user-input"
          placeholder="Type your message here..."
          rows="1"
          autofocus
        ></textarea>
        <button id="send-button">Send</button>
      </div>
    </div>

    <footer>
      <p>Cloudflare Workers AI Chat Template &copy; 2025</p>
      <p>Created by <span class="footer-handle">Pick-of-Gods @ RUNESCAPE.COM</span></p>
    </footer>

    <script>
      class ChatApp {
        constructor() {
          // DOM elements
          this.chatMessages = document.getElementById("chat-messages");
          this.userInput = document.getElementById("user-input");
          this.sendButton = document.getElementById("send-button");
          this.typingIndicator = document.getElementById("typing-indicator");
          this.modelSelect = document.getElementById("model-select");
          this.temperatureInput = document.getElementById("temperature-input");
          this.topKInput = document.getElementById("topK-input");
          this.topPInput = document.getElementById("topP-input");

          // Chat state
          this.chatHistory = [];
          this.isProcessing = false;

          // Initialize event listeners and display initial message
          this.initEventListeners();
          this.displayInitialMessage();
        }

        initEventListeners() {
          this.sendButton.addEventListener("click", () => this.sendMessage());
          this.userInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              this.sendMessage();
            }
          });
          this.userInput.addEventListener("input", () => this.resizeInput());
        }

        displayInitialMessage() {
          this.addMessageToChat(
            "assistant",
            "Hello! I'm an LLM chat app powered by both Workers AI and the Gemini API. How can I help you today?"
          );
        }

        addMessageToChat(role, content) {
          const messageEl = document.createElement("div");
          messageEl.className = `message ${role}-message`;
          messageEl.innerHTML = `<p>${content}</p>`;
          this.chatMessages.appendChild(messageEl);
          this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
        }

        resizeInput() {
          this.userInput.style.height = "auto";
          this.userInput.style.height = `${this.userInput.scrollHeight}px`;
        }

        async sendMessage() {
          const message = this.userInput.value.trim();
          if (!message || this.isProcessing) return;

          this.isProcessing = true;
          this.userInput.disabled = true;
          this.sendButton.disabled = true;

          this.addMessageToChat("user", message);
          this.chatHistory.push({ role: "user", content: message });
          
          this.userInput.value = "";
          this.userInput.style.height = "auto";

          this.typingIndicator.classList.add("visible");

          try {
            const assistantMessageEl = document.createElement("div");
            assistantMessageEl.className = "message assistant-message";
            assistantMessageEl.innerHTML = "<p></p>";
            this.chatMessages.appendChild(assistantMessageEl);

            this.chatMessages.scrollTop = this.chatMessages.scrollHeight;

            const selectedModel = this.modelSelect.value;
            const apiMessages = this.chatHistory.filter((msg) => msg.role !== "system");

            // Gather advanced parameters
            const params = {
              model: selectedModel,
              messages: apiMessages,
              temperature: parseFloat(this.temperatureInput.value),
              topK: parseInt(this.topKInput.value),
              topP: parseFloat(this.topPInput.value),
            };

            const response = await fetch("/api/chat", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(params),
            });

            if (!response.ok) {
              throw new Error("Failed to get response");
            }

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let responseText = "";

            while (true) {
              const { done, value } = await reader.read();
              if (done) break;

              const chunk = decoder.decode(value);
              responseText += chunk;
              assistantMessageEl.querySelector("p").textContent = responseText;
              this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
            
            this.chatHistory.push({ role: "assistant", content: responseText });
          } catch (error) {
            console.error("Error:", error);
            this.addMessageToChat("assistant", "Sorry, there was an error processing your request.");
          } finally {
            this.typingIndicator.classList.remove("visible");
            this.isProcessing = false;
            this.userInput.disabled = false;
            this.sendButton.disabled = false;
            this.userInput.focus();
          }
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        new ChatApp();
      });
    </script>
  </body>
</html>
